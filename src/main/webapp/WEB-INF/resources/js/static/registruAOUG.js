var registruAOUGTable;var addAOUGForm = $('#modal-addRegistru-aoug-form');var rezervaAOUGForm = $('#modal-rezerva-aoug-form');var editForm = $('#modal-editRegistru-aoug-form');var selected;var lastAoug;jQuery.validator.addMethod("checkAoug", function (value, element) {    return this.optional(element) || checkNrInregistrareAOUG(value);}, 'Num&#259;rul de &#238;nregistrare exist&#259; deja &#238;n registru sau nu este un num&#259;r consecutiv');function findLastNrInregistrareAoug() {    var token = $("meta[name='_csrf']").attr("content");    var header = $("meta[name='_csrf_header']").attr("content");    $.ajax({        type: 'get',        url: '/app/secure/registru/get-last-aoug',        contentType: "application/json",        async: false,        beforeSend: function (xhr) {            xhr.setRequestHeader(header, token);        },        success: function (response) {            if (response) {                lastAoug = response;            }        },        error: function () {            lastAoug = '1';        }    });}function checkNrInregistrareAOUG(value) {    var token = $("meta[name='_csrf']").attr("content");    var header = $("meta[name='_csrf_header']").attr("content");    var retVal = true;    $.ajax({        type: 'get',        url: '/app/secure/registru/duplicate/aoug/' + value,        async: false,        beforeSend: function (xhr) {            xhr.setRequestHeader(header, token);        },        contentType: 'application/json',        success: function (response) {            if (response.id < 0) {                retVal = false;            }        }    });    return retVal;}$(document).ready(function () {    getAllTipContinut('addRegistru-aoug-form-idTipContinut');    getAllTipContinut('editRegistru-aoug-form-idTipContinut');    getAllDestinatari('addRegistru-aoug-form-idDestinatar');    getAllDestinatari('editRegistru-aoug-form-idDestinatar');    $('#registru-aoug').addClass('active');    $('#registru-aoug-table').find('thead th').each(function () {        var title = $('#registru-aoug-table').find('thead th').eq($(this).index()).text();        $(this).append('<input style="display:none;" type="text" placeholder="Caut&#259; ' + title + '" />');    });    try {        registruAOUGTable = $('#registru-aoug-table').DataTable({            "ajax": {                "url": '../app/secure/registru/get-aoug',                "dataSrc": ""            },            "buttons": [                {                    extend: 'excel',                    text: '<span class="fa fa-file-excel-o" title="Apasa ALT+X pentru a salva tabelul in format Excel">&nbsp;&nbsp;</span><span>XLS</span>',                    className: 'btn btn-default',                    key: {                        key: 'x'                    },                    exportOptions: {                        columns: ':visible'                    }                }, {                    extend: 'pdf',                    text: '<span class="fa fa-file-pdf-o" title="Apasa ALT+F pentru a salva tabelul in format PDF">&nbsp;&nbsp;</span><span>PDF</span>',                    className: 'btn btn-default',                    key: {                        key: 'f'                    },                    orientation: 'landscape',                    title: 'Registru A.OUG',                    exportOptions: {                        columns: ':visible'                    }                }, {                    extend: 'print',                    text: '<span class="fa fa-print" title="Apasa ALT+P pentru a trimite la print">&nbsp;&nbsp;</span><span>Print</span>',                    className: 'btn btn-default',                    key: {                        key: 'p'                    },                    title: 'Registru A.OUG',                    exportOptions: {                        columns: ':visible'                    }                },                {                    extend: 'colvis',                    text: '<span class="fa fa-adjust">&nbsp;&nbsp;</span><span>Alege coloane vizibile</span>',                    className: 'btn btn-default'                }            ],            "columns": [                {                    "data": "nrInregistrare",                    "className": 'text-bold'                },                {                    "data": "dataInregistrare",                    "className": 'text-bold'                },                {"data": "nrSiDataDocumentului"},                {"data": "emitent"},                {"data": "continut"},                {"data": "dataExpediere"},                {"data": "destinatar"},                {"data": "formatFizic"}            ],            "columnDefs": [                {                    "targets": [0],                    "visible": true,                    "bUseRendered": true,                    "fnCreatedCell": function (nTd, sData, oData, i) {                        if (oData.anulat != 1 && oData.rezervat == 1) {                            $(nTd).closest('tr').addClass('rand-rezervat');                            $(nTd).closest('tr').prop('title', 'Aceasta înregistrare este rezervata');                            $(nTd).html('<a class="btn rezervat fa fa-edit"></a>  ' + oData.nrInregistrare);                        }                    }                },                {                    "targets": [1, 5],                    "bUseRendered": true,                    "visible": true,                    "render": function (data, type, row) {                        if (data) {                            return generateFormattedDate(new Date(data));                        } else {                            return '';                        }                    },                    "fnCreatedCell": function (nTd, sData, oData, i) {                        if (oData.anulat == 1) {                            $(nTd).closest('tr').css('text-decoration', 'line-through')                            $(nTd).closest('tr').css('color', 'gray');                        }                    }                },                {                    "targets": [7],                    "bUseRendered": true,                    "visible": true,                    "fnCreatedCell": function (nTd, sData, oData, i) {                        var anulat = oData.anulat;                        $(nTd).html('<div class="checkbox"><label><input class="format-fizic" data-path="aoug" id="aoug-' + oData.idRegistruAoug + '" type="checkbox" ' + (sData == 0 ? (anulat == 1 ? 'disabled="disabled" ' : '' ) : ' checked="" disabled="disabled" ') + '></label></div>');                        if (oData.rezervat == 1) {                            $(nTd).closest('tr').find('input[type="checkbox"]').prop('disabled', 'disabled');                        }                    }                }            ],            dom: '<"clear"><"break-row"><"pull-right"B>lrtip<"break-row-lg">'        });    } catch (err) {        console.log(err);    }    registruAOUGTable.columns().every(function () {        var that = this;        $('input', this.header()).on('keyup change', function () {            that                .search(this.value)                .draw();        });    });    $("#registru-aoug-search").on('keyup', function () {        registruAOUGTable.search(this.value).draw();    });    $(document).on('click', '#anuleazaAoug', function () {        selectedRowId = registruAOUGTable.row('.selected').data().idRegistruAoug;        anuleazaPath = 'aoug';        confirmModalAnuleazaInregistrare();    });    $(document).on('shown.bs.modal', '#modal-addRegistru-aoug', function () {        findLastNrInregistrareAoug();        getAllTipContinut('addRegistru-aoug-form-idTipContinut');        getAllDestinatari('addRegistru-aoug-form-idDestinatar');        $('#addRegistru-aoug-form-dataInregistrare').val(generateFormattedDate(new Date()));        $('#addRegistru-aoug-form-nrInregistrare').val(lastAoug);    });    $(document).on('shown.bs.modal', '#modal-rezerva-aoug', function () {        $('#rezerva-aoug-form-dataInregistrare').val(generateFormattedDate(new Date()));        $('#rezerva-aoug-form-dataInregistrare').prop('disabled', 'disabled');    });    addAOUGForm.validate({        rules: {            required: true,            idDestinatar: {                'dependentBA-aoug': true,                required: false            },            nrInregistrare: {                checkAoug: true            },            dataExpediere: {                'dependentAB-aoug': true,                required: false            },            formatFizic: {                required: false            },            emitent: {                required: false            },            idTipContinut: {                required: false            },            nrSiDataDocumentului: {                required: false            }        },        messages: {            nrInregistrare: {required: "Acest c&#226;mp este obligatoriu"},            nrSiDataDocumentului: {required: "Acest c&#226;mp este obligatoriu"},            dataInregistrare: {required: "Acest c&#226;mp este obligatoriu"},            idTipContinut: {required: "Acest c&#226;mp este obligatoriu"},            emitent: {required: "Acest c&#226;mp este obligatoriu"},            continut: {required: "Acest c&#226;mp este obligatoriu"}        }    });    addAOUGForm.on('submit', function (e) {        e.preventDefault();        if (!$(this).valid()) {            return;        }        var token = $("meta[name='_csrf']").attr("content");        var header = $("meta[name='_csrf_header']").attr("content");        var nrInregistrare = $('#addRegistru-aoug-form-nrInregistrare').val();        var nrSiDataDocumentului = $('#addRegistru-aoug-form-nrSiDataDocumentului').val();        var dataInregistrare = $('#addRegistru-aoug-form-dataInregistrare').val();        var idTipContinut = $('#addRegistru-aoug-form-idTipContinut').val();        var emitent = $('#addRegistru-aoug-form-emitent').val();        var idDestinatar = $('#addRegistru-aoug-form-idDestinatar').val();        var continut = $('#addRegistru-aoug-form-continut').val();        var dataExpediere = $('#addRegistru-aoug-form-dataExpediere').val();        var formatFizic = $('#addRegistru-aoug-form-formatFizic').prop('checked') ? 1 : 0;        var dataToSend = {            "nrInregistrare": nrInregistrare, "dataInregistrare": processDateForServer(dataInregistrare),            "emitent": emitent, "nrSiDataDocumentului": nrSiDataDocumentului,            "idTipContinut": idTipContinut, "idDestinatar": idDestinatar,            "continut": continut, "dataExpediere": processDateForServer(dataExpediere), "formatFizic": formatFizic        };        $.ajax({            type: 'post',            url: $(this).attr('action'),            beforeSend: function (xhr) {                xhr.setRequestHeader(header, token);            },            async: false,            dataType: 'json',            contentType: 'application/json',            mimeType: 'application/json',            data: JSON.stringify(dataToSend),            success: function (response) {                $('#modal-addRegistru-aoug').modal('hide');                addAOUGForm.trigger('reset');                $('.chosen-select').trigger(chosenUpdated);                showNotification(response.message, 'Success', SUCCESS);                registruAOUGTable.ajax.reload(null, false);            },            error: function () {                showNotification("Error. Mai &#238;ncerca&#539;i o dat&#259;.", "Error", ERROR);            }        });    });    editForm.validate({        rules: {            required: true,            idDestinatar: {                'dependentBA-aoug': true,                required: false            },            nrInregistrare: {                checkAoug: true            },            dataExpediere: {                'dependentAB-aoug': true,                required: false            },            formatFizic: {                required: false            },            emitent: {                required: false            },            idTipContinut: {                required: false            },            nrSiDataDocumentului: {                required: false            }        },        messages: {            nrInregistrare: {required: "Acest c&#226;mp este obligatoriu"},            nrSiDataDocumentului: {required: "Acest c&#226;mp este obligatoriu"},            dataInregistrare: {required: "Acest c&#226;mp este obligatoriu"},            idTipContinut: {required: "Acest c&#226;mp este obligatoriu"},            emitent: {required: "Acest c&#226;mp este obligatoriu"},            continut: {required: "Acest c&#226;mp este obligatoriu"}        }    });    editForm.on('submit', function (e) {        e.preventDefault();        if (!$(this).valid()) {            return;        }        var token = $("meta[name='_csrf']").attr("content");        var header = $("meta[name='_csrf_header']").attr("content");        var idRegistruAoug = $('#editRegistru-aoug-form-idRegistruAoug').val();        var nrInregistrare = $('#editRegistru-aoug-form-nrInregistrare').val();        var nrSiDataDocumentului = $('#editRegistru-aoug-form-nrSiDataDocumentului').val();        var dataInregistrare = $('#editRegistru-aoug-form-dataInregistrare').val();        var idTipContinut = $('#editRegistru-aoug-form-idTipContinut').val();        var emitent = $('#editRegistru-aoug-form-emitent').val();        var idDestinatar = $('#editRegistru-aoug-form-idDestinatar').val();        var continut = $('#editRegistru-aoug-form-continut').val();        var dataExpediere = $('#editRegistru-aoug-form-dataExpediere').val();        var creatDe = $('#editRegistru-aoug-form-creatDe').val();        var creatLa = $('#editRegistru-aoug-form-creatLa').val();        var formatFizic = $('#editRegistru-aoug-form-formatFizic').prop('checked') ? 1 : 0;        var dataToSend = {            "idRegistruAoug": idRegistruAoug, "nrInregistrare": nrInregistrare,            "dataInregistrare": processDateForServer(dataInregistrare),            "emitent": emitent, "nrSiDataDocumentului": nrSiDataDocumentului,            "idTipContinut": idTipContinut, "idDestinatar": idDestinatar,            "continut": continut, "creatDe": creatDe, "creatLa": creatLa,            "dataExpediere": processDateForServer(dataExpediere), "formatFizic": formatFizic        };        $.ajax({            type: 'post',            url: $(this).attr('action'),            beforeSend: function (xhr) {                xhr.setRequestHeader(header, token);            },            async: false,            dataType: 'json',            contentType: 'application/json',            mimeType: 'application/json',            data: JSON.stringify(dataToSend),            success: function (response) {                $('#modal-editRegistru-aoug').modal('hide');                editForm.trigger('reset');                $('.chosen-select').trigger(chosenUpdated);                showNotification(response.message, 'Success', SUCCESS);                registruAOUGTable.ajax.reload(null, false);            },            error: function () {                showNotification("Error. Mai &#238;ncerca&#539;i o dat&#259;.", "Error", ERROR);            }        });    });    rezervaAOUGForm.validate({        rules: {            required: true,            dataInregistrare: {                todayOnly: true            }        },        messages: {            numarInregistrari: {                required: "Acest c&#226;mp este obligatoriu"            },            dataInregistrare: {                required: "Acest c&#226;mp este obligatoriu"            }        }    });    rezervaAOUGForm.on('submit', function (e) {        if (!$(this).valid()) {            return;        }        var token = $("meta[name='_csrf']").attr("content");        var header = $("meta[name='_csrf_header']").attr("content");        var numarInregistrari = $('#rezerva-aoug-form-numarInregistrari').val();        var dataInregistrare = $('#rezerva-aoug-form-dataInregistrare').val();        var dataToSend = {            "numarInregistrari": numarInregistrari, "dataInregistrare": processDateForServer(dataInregistrare)        };        $.ajax({            type: 'post',            url: $(this).attr('action'),            beforeSend: function (xhr) {                xhr.setRequestHeader(header, token);            },            dataType: 'json',            contentType: 'application/json',            mimeType: 'application/json',            data: JSON.stringify(dataToSend),            success: function (response) {                $('#modal-rezerva-aoug').modal('hide');                rezervaAOUGForm.trigger('reset');                $('.chosen-select').trigger(chosenUpdated);                registruAOUGTable.ajax.reload(null, false);                showNotification(response.message, 'Success', SUCCESS);            },            error: function () {                showNotification("Eroare. Mai &#238;ncerca&#539;i o dat&#259;.", "Eroare", ERROR);            }        });        e.preventDefault();    });    $(document).on('click', '.rezervat', function () {        rezervaData = registruAOUGTable.row($(this).closest('tr')).data();        rezervaPath = 'aoug';        var editModal = $('#modal-editRegistru-aoug');        var idRegistruAoug = $('#editRegistru-aoug-form-idRegistruAoug');        var creatDe = $('#editRegistru-aoug-form-creatDe');        var creatLa = $('#editRegistru-aoug-form-creatLa');        var nrInregistrare = $('#editRegistru-aoug-form-nrInregistrare');        var dataInregistrare = $('#editRegistru-aoug-form-dataInregistrare');        editForm.trigger('reset');        idRegistruAoug.val(rezervaData.idRegistruAoug);        creatDe.val(rezervaData.creatDe);        creatLa.val(rezervaData.creatLa);        nrInregistrare.val(rezervaData.nrInregistrare);        nrInregistrare.prop('disabled', 'disabled');        dataInregistrare.val(processDateForClient(rezervaData.dataInregistrare));        dataInregistrare.prop('disabled', 'disabled');        editModal.modal('show');    });    $(document).on('click', '#advanced-search', function () {        $('#registru-aoug-table').find('thead th input').each(function (i) {            $(this).toggle('display');            if (i == 0) {                $(this).focus();            }        });    });    $(document).keyup(function (e) {        if (e.keyCode == 27) {            $('#registru-aoug-table').find('thead th input').each(function (i) {                $(this).hide();            });        }    });});